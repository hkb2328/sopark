Date : 26-05-2024
SQL Queries:
175. Combine Two Tables :
	SELECT P.Fistname,P.Lastname,A.City,A.State
	FROM Person P LEFT JOIN Address A 
	ON P.PersonId=A.PersonId

176. Second highest Salary:
	a. SELECT salary AS SecondHighestSalay 
	   	FROM Employee ORDER BY Salary Limit 1 OFFSET 1;
	b. with CTE AS
		(Select *,dense_rank() over(order by salary) as rnk from employee)
	   select c.salary as 'SecondHighestSalary' from CTE c where c.salary=2
	c. select Salary from employee where salary<(select max(salary) from employee) limit 1

177. Nth highest salary:
	
	CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
	BEGIN
	SET N=N-1;
	RETURN
		(SELECT Salary from Employee order by salary desc limit 1 offset N );
		
	END

178. RANK SCORES:
	
	SELECT Score,DENSE_RANK() OVER(ORDER BY Score DESC) as 'RANK' FROM Scores

180. CONSECUTIVE NUMBERS:
	select distinct num from logs l1 inner join logs l2 where l1.id = l2.id+1 and l1.id = l2.id-1 and 
	l1.num=l2.num
	

181. Employees Earning More than Managers
	
	select e1.name as employeename from employee e1 join employee e2 where e1.managerid=e2.id and e1.salary>e2.salary

182. Duplicate Emails:
	a. select Email from person group by Email having count(*) >1;

183. Customers who Never Ordered Anything:
	a. select name from customers where id not in (select cutsomerId from orders)
	b. select c.name from customers c left join orders o on c.id <> c.CustomerID


184. Department Highest Salary:
	a. WITH CTE AS(
		select d.name as 'dept_name',e.name as 'emp_name' ,e.salary ,
		dense_rank() over(partition by e.departmentid order by e.salary desc) as 'rnk'
		from employee e left join department d on e.departmentid=d.department)
	   select c.dept_name, c.emp_name, c.salary from CTE c  where rnk=1

185. 184. Department TOP THREE Salaries:
	   WITH CTE AS(
		select d.name as 'dept_name',e.name as 'emp_name' ,e.salary ,
		dense_rank() over(partition by e.departmentid order by e.salary desc) as 'rnk'
		from employee e left join department d on e.departmentid=d.department)
	   select c.dept_name, c.emp_name, c.salary from CTE c  where rnk <=3

 196. DELETE DUPlicate Emails:
	
	delete p2 from person p1 join person p2 on p1.email=p2.email and p1.id < p2.id

197. RISING Temperature:
	
	select p1.id from weather w1 join weather w2 on w1.id>w2.id and datediff(w1.recorddate,w2.recorddate)=1 and w1.temperature>w2.temperature

262.Trips and USERS:
	a. select t.request_at, round(sum(case when t.status in ('cancelled_by_driver', 'cancelled_by_client') then 1 else 0 end)/
    		sum(t.*),2) as ''cancellation_rate
		from trips t 
		join users u1 on t.client_id = u1.users_id and u1.banned='NO'
		join users u2 on t.driver_id= u2.users_id and u2.banned='NO'
		where  t.request_at between "2013-10-01" and "2013-10-03"

DAY: 2 => Date: 27-05-2024

511.Game Play Analysis I.
	a. with cte as (select *, rank() over(partition by player_id order by event_date) as rnk
	   from Actitvity)
	   select c.player_id, c.event_date as 'first_login_date' from cte c where c.rnk=1

	b. select player_id, min(event_date) as 'first_login_date from activity group by player_id

512. Game Play Analysis II
	select distinct player_id,device_id from activity where (player_id,event_date) in 
		(select player_id, min(event_date) from activity group by player_id)

534. Game Play Analysis III
	select player_id, event_date, 
	sum(games_played)over(partition by player_id rows between unbounded preceding and current row) as 'games_played_so_far'
	from activity

550. Game Play Analysis IV
	
	select round(count(distinct b.player_id),count(distinct a.player_id,2) as fraction from 
	(select player_id, min(event_date) from activity group by player_id)a join activity b 
	on a.player_id = b.player_id and a.event_date+1 = b.event_date

569. Median Employee Salary:
	
	didn't understood

570. Managers with atleast 5 direct Reports:
	select name from employee where id in 
	(select managerId from employee group by managerId having count(managerId)>=5)

571. Find Median Given Frequency of Numbers:
	
	need approach


574. WInning Candidate:
	select name from candidate where id in 
	(select candidateId from vote group by candidateId order by count(*) limit 1)


577. Employee Bonus:
	select e.name from employee e left join bonus b e.empId=b.empId where b.bouns < 1000 or bonus is null

578. Highest Answer rate Question:
	with cte as (
	select question_id, count(case when action='answer' then 1 else 0 end)/count(case when action='show' then 1 else 0 end)
	from surveylog group by question_id order by count(case when action='answer' then 1 else 0 end)/count(case when action='show' then 1 	else 0 end) desc limt 1)
	select c.question_id as surveylogs from cte c

579. Find Cummulative Salary of an Employee:
	select id, month,
	sum(salary) over(partition by Id order by month desc) as salary
	from employee where month<4

580. Count Student number in Departments:

	select d.dept_name, ifnull(count(s.student_id),0) as student_number from department d left join student s 
	on d.departmentId = s.departmentId group by d.dept_name, s.student_id order by student_number, d.dept_name

584. Find Customer Refree:
	select name from customer where referee_id != 2


585. INvestments in 2016:
	select sum(tiv_2016) as tiv_2016 
	from insurance i1 join insurance i2 on i1.tiv_2015=i2.tiv_2015 and (i1.lat != i2.lat or i1.lon != i2.lon)


586. Customer placing the largest number of orders:
	select customer_number from orders group by customer_number order by count(*) desc limit 1

595. Big Countries:
	select name, population, area from world where area>3000000 or population>2500000

596. classes more than 5 students:
	select class from courses group by class having count(*) >=5

597. Friend Request I:
	select round(ifnull(count(*)/(select count(*) from friend_request),0),2) as accept_rate
	from friend_request fr join reuqest_accepted ra on
	fr.sender_id= ra.requester_id and fr.send_to_id = ra.accepter_id

601. Human Traffic of Stadium:
	select * 
	from stadium s1 join stadium s2 join stadium s3
	on (s1.id = s2.id-1 and s1.id = s3.id-2) or
	(s1.id = s2.id+1 and s1.id = s3.id-1) or
	(s1.id = s2.id+1 and s1.id = s3.id+2) or
	where s1.people >= 100 and s2.people>=100 and s3.people>=100
	order by visit_date

DAY 3: Date: 28-05-2024

602 Friend Requests II:
	with cte as (select request_id, as id, count(*) as num from request_accepted 
	group by requester_id
	union
	select accpter_id as id, count(*) as num from request_accpeted group by accepter_id)
	select id, count(distinct num) from cte group by id


603. Consecutive Available seats:
	
	select s1.seat_id 
	from seats s1, seats s2 join s1.seat_id = s2.seat_id+1 and s1.free = s2.free
	where s1.free=1 and s2.free=1 

607. Sales Person:
	
	select name from salesperson where name not in 
	(select distinct s.name from salesperson s , orders o, company c
	where c.name = 'RED' and s.sales_id = o.sales_id and o.com_id = c.com_id)

608. Tree Node:
	select id,
		case when p_id is null then 'Root'
		case when id in ( select distinct p_id from tree where p_id is notnull) then 'inner'
		else 'leaf' end as type
	from tree
	
610. Triangle Judgement:
	
	select x,y,z, case when x+y>z and y+z>x and z+x>y then 'yes'
	else 'no' end as triangle_formation from triangle 

612. Shortest distance in a plane:
	select min(round(sqrt(((t1.x-t2.x)*(t1.x-t2.x))+((t1.y-t2.y)*(t1.y-t2.y))),2))
	from point_2d t1, point_2d t2 
	where t1.x!=t2.x and t1.y!=t2.y

613. shortest distance in aLine:
	select min(t2.x-t1.x) as shortest from point t1, point t2 where t1.x <> t2.x

614. Second Degree Follower:
	
	select f1.follower, count(distinct f2.follower) as num from 
	follow f1 join follow f2 on f1.follower = f2.followee
	group by f1.follower

615. Average salary: Departmentts  VS Company.
	need explaination

618. students report by Geography:
	need explaination

619. Biggest Single Number:
	a. select num, count() over(partition by num order by num desc) as cnt from number
	where cnt = 1 limit 1 offset 1
	b. select num from number group by num having count(num)=1 order by num desc limit 1 

620. Not Boring Movies:
	select movie from cinema where id%2=1 and decription <> 'boring' order by rating desc.

626. Exchange Seats:
	select
	if(s1.id<(select max(s1.id) from seat),if(s1.id%2=0,s1.id-1,s1.id+1),if(s1.id%2=0,s1.id-1,s1.id)) as id, s2.name from seat s1
	join  seats s2 on s1.id = s2.id
	
627. swap Salary
	update  salary set sex= case when sex='m' then 'f' else 'm' end

1045. Cutsomers who Bought all products:

	with cte as (select cutsomer_id, product_id from customer where product_key in (select product_key from product))
	select distinct c.customer_id from  cte c group by c.customer_id 
	having count(*) = (select count(distinct product_key) from product)

1050.  Actors and directors who cooperated at least three times.
	
	select actor_id, director_id from actordirector group by actor_id, director_id having count(*)>=3
		
1068. Product Sales Analysis 1:
	select p.product_name, s.year, s.price from sales s join product p on s.product_id = p.product_id

1069. Product Sales Analysis II:
	select product_id, sum(quantity) as total_quantity_sold from sales group by product_id

1070. Product Sales Analysis III:
	with cte as (select *,
	rank() over(partition by product_id order by year ) as rnk
	from sales)
	select product_id, year, quantity, price from cte where rnk=1 limit1

1075. Project Employees I

	select project_id, round(avg(e.experience_years),2) as avg_exp
	from project p left join employee e on p.employee_id=e.employee_id
	group by project_id

1076. Project Employees II
	select p.project_id from project p join employee e on p.employee_id = e.employee_id
	group by p.project_id order by count(*) desc limt 1
	
1077. Project Employees III:
	select p.project_id,e.employee_id 
	from project p join employee e on p.employee_id = e.employee_id where (p.project_id, e.experience_years) in 
	 (select p.project_id,max(e.experience_years) as total exp
	from project p join employee e on p.employee_id = e.employee_id group by p.project_id )

1082. Sales Analysis I:

	select seller_id from sales group by seller_id having sum(price)=
	(select sum(price) from sales group by seller_id order by sum(price) desc limit 1)

1083. Sales Analysis II:
	select buyer_id from sales s join product p on s.product_id = p.product_id where  p.product_name='S8'and s.buyer_id not in
	(select buyer_id from sales s join product p on s.product_id = p.product_id where  p.product_name='iphone')

1084. Sales Analysis III:
	(select distinct p.product_id, p.product_name from sales s join product p on s.product_id = p.product_id
	where s.sale_date between '2019-01-01' and '2019-03-31')
	except
	(select distinct p.product_id, p.product_name from sales s join product p on s.product_id = p.product_id
	where s.sale_date < '2019-01-01' and s.sale_Date>'2019-03-31')

1097.  Game play Analysis V
	need explaination

1098. Unpopular Books:
	
	select b.book_id, b.name from books b join orders o on o.book_id = p.book_id group by o.book_id having sum(quantity)<10
	except
	(select book_id,name from books where available_from between '2019-05-24' and '2019-05-23')

1107. New Users Daily count:
	select first_login , count(*) from 
	(select user_id, min(activity_date) as first_login from traffic where activity='login'
	group by activity_date having activity_date between '2019-04-01' and '2019-06-30') x
	group by x.first_login 
	
1112. Highest Grade for Each STudent:
	
	with cte as (select student_id, course_id,grade 
	rank() over(partition by student_id order by grade desc, course_id min) as rnk
	from enrollments)
	select student_id,course_id,grade from cte where rnk=1 order by student_id

1113. Reported Posts:
	need explaination

1126. Active Business
	select distinct business_id from events e join
	(select event_type, avg(occurances) avg_occ from events group by evet_type) x
	e.event_type = x.event_type and e.occurances > x.avg_occ group by business_id having count(event_type)>1

1127. User Purchase Platform:
	
	select spend_date,platform,sum(amount) total_amount, count(user_id)as users from spending group by spend_date, platform
	union
	select spend_date, case when count(distinct platform) =2 then 'both' as platform,
	sum(amount) as total_Amount, count(user_id)as users from spending group by spend_date

	<Need Explaination>


1132. Reported Posts II:
	<undertansd the question>

1141. User activity for the past 30 days I:
	
	select acitivity_date, count(distinct user_id) as active_users from activity 
	where activity_date > '2019-06-26' and activity_date < '2019-07-27'
	 group by activity_date

1142. User activity for the past 30 Days II.
	with cte as (select user_id, sum(session_id) as total_session from activity 
	where date_diff('2019-07-27',activity_year)<=30 group by user_id)
	select sum(total_session)/count(user_id) as 'avg_Sessions_per_user' from cte
	
1148. Article Views I.
	select distinct author_id as id from views where author_id = viewer_id order by author_id

1149. Article Views II.
	 select distinct viewer_id as id  from views group by viewer_id, view_date having count(distinct article_id)>1 order by id

1158. Market Analysis I.
	select u.user_id, u.join_date, ifnull(count(distinct order_id),0) as cnt
	from users u left join orders o on u.user_id=o.buyer_id	where year(order_date) =2019

1159. Market Analysis II 
	Need expalaination.

1164. Product Prices at a Given Date.
	with cte as (select p1.product_id, ifnull(p1.new_price,10) as new_price, change_date,
	rank() over(partition by p1.product_id order by p1.change_date desc) as rnk from 
	products p1 left join products p2 on p1.product_id = p2.product_id and p1.change_date<'2019-08-17')
	
	select c.product_id, c.new_price from cte c where c.rnk=1

1173. Immediate Food Delivery I:
	
	select round(avg(when case order_date=customer_pref_delivery_date then 1 else 0 end),2) * 100 as avg
	from delivery 

	
	







































	




